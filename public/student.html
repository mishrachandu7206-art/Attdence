<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Student - Attendance</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-100 p-6">
    <div class="max-w-2xl mx-auto">
      <h1 class="text-2xl font-bold mb-4">Student Portal</h1>

      <section class="bg-white p-4 rounded shadow mb-4">
        <h2 class="font-semibold">View Attendance</h2>
        <div class="mt-2 grid grid-cols-3 gap-2">
          <select id="classSelect" class="border p-2"></select>
          <select id="studentSelect" class="border p-2"></select>
          <button id="viewAtt" class="bg-blue-600 text-white px-4 py-2 rounded">View</button>
        </div>
        <div id="attList" class="mt-3"></div>
      </section>
    </div>

    <script>
      const api = '/api';
      async function loadClasses() {
        const res = await fetch(api + '/classes');
        const data = await res.json();
        const sel = document.getElementById('classSelect'); sel.innerHTML = '';
        data.forEach(c => { const opt = document.createElement('option'); opt.value = c._id; opt.textContent = c.name; sel.appendChild(opt); });
        if (data[0]) {
          sel.value = data[0]._id;
          await loadStudentsForClass(data[0]._id);
        }
      }

      async function loadStudentsForClass(classId) {
        const res = await fetch(api + '/students?classId=' + classId);
        const students = await res.json();
        const sel = document.getElementById('studentSelect'); sel.innerHTML = '';
        students.forEach(s => {
          const opt = document.createElement('option'); opt.value = s._id; opt.textContent = s.name + (s.roll ? (' (' + s.roll + ')') : ''); sel.appendChild(opt);
        });
      }

      document.getElementById('classSelect').addEventListener('change', (e) => loadStudentsForClass(e.target.value));

      document.getElementById('viewAtt').addEventListener('click', async () => {
        const classId = document.getElementById('classSelect').value;
        const studentId = document.getElementById('studentSelect').value;
        if (!classId || !studentId) return alert('Select class and student');
        const res = await fetch(api + '/attendance?studentId=' + studentId + '&classId=' + classId);
        const records = await res.json();
        const out = document.getElementById('attList'); out.innerHTML = '';
        if (!records.length) return out.textContent = 'No attendance records found for this student in this class.';
        records.forEach(r => {
          const d = document.createElement('div'); d.className = 'p-2 border-b'; d.textContent = `Date: ${r.date}`; out.appendChild(d);
        });
      });

      loadClasses();
    </script>
  </body>
</html>
